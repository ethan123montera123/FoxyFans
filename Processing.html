<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing Applicants | FoxyFans</title>
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK -->
    <script type="module">
        // Import necessary Firebase functions
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBQv0xhSZS0Sv--8ohXsrtME_HLlVTOeLg",
            authDomain: "foxyfans-e9761.firebaseapp.com",
            projectId: "foxyfans-e9761",
            storageBucket: "foxyfans-e9761.firebasestorage.app",
            messagingSenderId: "509215295074",
            appId: "1:509215295074:web:2bb6485985db4b99e2333b"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Check if the user is logged in on page load
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                // If the user is not authenticated, redirect to login page
                window.location.href = "login.html";
            } else {
                // User is authenticated, proceed to dashboard
                console.log("User logged in:", user.email);
            }
        });

        // Add active class dynamically based on the current page
        const currentPage = window.location.pathname;
        if (currentPage.includes("dashboard.html")) {
            document.getElementById("homeLink").classList.add("bg-blue-700");
        } else if (currentPage.includes("applicants.html")) {
            document.getElementById("applicantsLink").classList.add("bg-blue-700");
        } else if (currentPage.includes("status.html")) {
            document.getElementById("statusLink").classList.add("bg-blue-700");
        }

        // Logout function
        window.logoutUser = async function() {
            try {
                await signOut(auth);
                alert("You have been logged out.");
                window.location.href = "login.html"; // Redirect to login page after logout
            } catch (error) {
                console.error("Error signing out: ", error);
            }
        }

        // Function to fetch processing applicants from Firebase and display them
        window.fetchProcessingApplicants = function() {
            const applicationsRef = ref(database, 'applications');  // Firebase reference to '/applications'
            const processingApplicants = [];

            // Fetch applications data from Firebase
            onValue(applicationsRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    Object.keys(data).forEach((key) => {
                        const applicant = data[key];
                        // Filter for Processing status
                        if (applicant.status === 'Processing') {
                            processingApplicants.push(applicant);
                        }
                    });

                    // Render processing applicants in a table
                    renderProcessingApplicants(processingApplicants);
                } else {
                    document.getElementById('processingApplicants').innerHTML = '<p class="text-gray-500">No processing applicants found.</p>';
                }
            });
        };

        // Function to render the processing applicants in a table
        window.renderProcessingApplicants = function(applicants) {
            const applicantsContainer = document.getElementById('processingApplicants');
            applicantsContainer.innerHTML = ''; // Clear previous content

            // Create table headers
            let tableContent = `
                <table class="min-w-full bg-white border border-gray-200 shadow-lg rounded-lg">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="py-3 px-6 text-left text-gray-700 font-semibold">Name</th>
                            <th class="py-3 px-6 text-left text-gray-700 font-semibold">Age</th>
                            <th class="py-3 px-6 text-left text-gray-700 font-semibold">Location</th>
                            <th class="py-3 px-6 text-left text-gray-700 font-semibold">Telegram Username</th>
                            <th class="py-3 px-6 text-left text-gray-700 font-semibold">Typing Test</th>
                            <th class="py-3 px-6 text-left text-gray-700 font-semibold">Work Experience</th>
                            <th class="py-3 px-6 text-left text-gray-700 font-semibold">Work Issues</th>
                            <th class="py-3 px-6 text-left text-gray-700 font-semibold">Last Job Performance</th>
                            <th class="py-3 px-6 text-left text-gray-700 font-semibold">Proof of Logouts</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // Create rows for each applicant
            applicants.forEach(applicant => {
                tableContent += `
                    <tr class="border-b border-gray-200">
                        <td class="py-3 px-6 text-gray-700">${applicant.name}</td>
                        <td class="py-3 px-6 text-gray-700">${applicant.age}</td>
                        <td class="py-3 px-6 text-gray-700">${applicant.location}</td>
                        <td class="py-3 px-6 text-gray-700">${applicant.telegramUsername}</td>
                        <td class="py-3 px-6 text-gray-700">${applicant.typingTest}</td>
                        <td class="py-3 px-6 text-gray-700">${applicant.workExperience}</td>
                        <td class="py-3 px-6 text-gray-700">${applicant.workIssues}</td>
                        <td class="py-3 px-6 text-gray-700">${applicant.lastJobPerformance}</td>
                        <td class="py-3 px-6 text-gray-700">${applicant.proofOfLogouts}</td>
                    </tr>
                `;
            });

            // Close the table
            tableContent += `
                    </tbody>
                </table>
            `;

            applicantsContainer.innerHTML = tableContent;
        };

        // Call the function to fetch processing applicants when the page loads
        window.onload = function() {
            fetchProcessingApplicants();
        };
    </script>
</head>
<body class="bg-gray-100">

    <!-- Sidebar and Main Content Wrapper -->
    <div class="flex h-screen">

        <!-- Sidebar -->
        <div class="bg-blue-600 w-64 p-4 text-white flex flex-col justify-between">
            <div>
                <h2 class="text-2xl font-semibold mb-6">FoxyFans Dashboard</h2>
                <nav>
                    <ul>
                        <!-- Active Link for Home -->
                        <li>
                            <a href="dashboard.html" id="homeLink" class="block py-2 px-4 rounded-lg hover:bg-blue-700 mb-2" aria-current="page">Home</a>
                        </li>
                        <!-- Active Link for Applicants -->
                        <li>
                            <a href="applicants.html" id="applicantsLink" class="block py-2 px-4 rounded-lg hover:bg-blue-700 mb-2">Applicants</a>
                        </li>
                        <!-- Active Link for Status -->
                        <li>
                            <a href="status.html" id="statusLink" class="block py-2 px-4 rounded-lg hover:bg-blue-700 mb-2">Status</a>
                        </li>
                    </ul>
                </nav>
            </div>

            <!-- Logout Button -->
            <div class="mt-auto">
                <button onclick="logoutUser()" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 mt-4">
                    Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-8 overflow-auto">

            <!-- Dashboard Grid -->
            <div class="grid grid-cols-1 gap-6">

                <!-- Processing Applicants Table -->
                <div class="bg-white p-6 rounded-lg shadow-lg col-span-3">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Processing Applicants</h3>
                    <p class="text-gray-600 mb-4">Here are the applicants currently in the processing stage.</p>
                    <div id="processingApplicants" class="overflow-x-auto">
                        <!-- Dynamic Content for Processing Applicants -->
                    </div>
                </div>

            </div>
        </div>
    </div>

</body>
</html>

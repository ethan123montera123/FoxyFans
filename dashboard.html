<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | FoxyFans</title>
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK -->
    <script type="module">
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBQv0xhSZS0Sv--8ohXsrtME_HLlVTOeLg",
            authDomain: "foxyfans-e9761.firebaseapp.com",
            projectId: "foxyfans-e9761",
            storageBucket: "foxyfans-e9761.appspot.com",
            messagingSenderId: "509215295074",
            appId: "1:509215295074:web:2bb6485985db4b99e2333b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Check if the user is logged in
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = "login.html"; // Redirect to login page
            }
        });

        window.logoutUser = async function() {
            try {
                await signOut(auth);
                alert("You have been logged out.");
                window.location.href = "login.html"; // Redirect to login page after logout
            } catch (error) {
                console.error("Error signing out: ", error);
            }
        }

        // Fetch applicants count from the status node
        window.fetchApplicantCounts = function() {
            const statusRef = ref(database, 'status');
            onValue(statusRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    let processingCount = 0;
                    let forReviewCount = 0;
                    let acceptedCount = 0;

                    // Count applicants in each status category
                    if (data.Processing) {
                        processingCount = Object.keys(data.Processing).length;
                    }
                    if (data['For Review']) {
                        forReviewCount = Object.keys(data['For Review']).length;
                    }
                    if (data.Accepted) {
                        acceptedCount = Object.keys(data.Accepted).length;
                    }

                    // Update the counts on the page
                    document.getElementById('processingCount').textContent = processingCount;
                    document.getElementById('forReviewCount').textContent = forReviewCount;
                    document.getElementById('acceptedCount').textContent = acceptedCount;
                }
            });
        };

        window.onload = function() {
            // Fetch the counts on page load
            fetchApplicantCounts();
        };
    </script>
</head>
<body class="bg-white">

    <div class="flex h-screen">

        <div class="bg-pink-600 w-full md:w-64 p-4 text-white flex flex-col justify-between">
            <div>
                <h2 class="text-2xl font-semibold mb-6">FoxyFans Dashboard</h2>
                <nav>
                    <ul>
                        <li>
                            <a href="dashboard.html" id="homeLink" class="block py-2 px-4 rounded-lg hover:bg-pink-700 mb-2">Home</a>
                        </li>
                        <li>
                            <a href="applicants.html" id="applicantsLink" class="block py-2 px-4 rounded-lg hover:bg-pink-700 mb-2">Applicants</a>
                        </li>
                        <li>
                            <a href="viewskillstest.html" id="skillsTestLink" class="block py-2 px-4 rounded-lg hover:bg-pink-700 mb-2">Skills Test</a>
                        </li>
                        <li>
                            <a href="status.html" id="statusLink" class="block py-2 px-4 rounded-lg hover:bg-pink-700 mb-2">Status</a>
                        </li>
                    </ul>
                </nav>
            </div>
    
            <div class="mt-auto">
                <button onclick="logoutUser()" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 mt-4">
                    Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-8 overflow-auto">

            <!-- Applicant Status Counts -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold">Applicant Status</h3>
                <p class="text-gray-600">Current count of applicants based on status.</p>
            </div>

            <!-- Status Counts -->
            <div class="grid grid-cols-3 gap-4">
                <div class="bg-white p-4 border rounded-lg shadow-lg">
                    <h4 class="text-lg font-semibold text-gray-700">Processing</h4>
                    <p class="text-xl font-bold text-gray-800" id="processingCount">0</p>
                </div>
                <div class="bg-white p-4 border rounded-lg shadow-lg">
                    <h4 class="text-lg font-semibold text-gray-700">For Review</h4>
                    <p class="text-xl font-bold text-gray-800" id="forReviewCount">0</p>
                </div>
                <div class="bg-white p-4 border rounded-lg shadow-lg">
                    <h4 class="text-lg font-semibold text-gray-700">Accepted</h4>
                    <p class="text-xl font-bold text-gray-800" id="acceptedCount">0</p>
                </div>
            </div>

        </div>
    </div>

</body>
</html>
